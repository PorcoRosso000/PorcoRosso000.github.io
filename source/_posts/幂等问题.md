---
title: 幂等问题
typora-root-url: 幂等问题
abbrlink: 244b6bbd
date: 2022-11-26 16:27:43
tags:
permalink:
---



## 接口的幂等

​    幂等的概念就是一次执行的结果，和多次执行的结果保持一致

超卖超买

接口安全 口令校验

 调用接口发生异常并且重复尝试时，会重复调用接口

 比如下面这些情况，如果没有实现接口幂等性会有很严重的后果： 支付接口，重复支付会导致多次扣钱 ；订单接口，同一个订单可能会多次创建。

![img](lu152441l02jn_tmp_a5fea3d4a3648dc7.png) 

## 为什么会产生接口幂等性问题？

 那么，什么情况下，会产生接口幂等性的问题呢？

- 网络波动, 	可能会引起重复请求
- 用户重复操作,用户在操作时候可能会无意触发多次下单交易,甚至没有响应而有意触发多次交易应用
- 使用了失效或超时重试机制(Nginx重试、RPC重试或业务层重试等)
- 页面重复刷新
- 使用浏览器后退按钮重复之前的操作,导致重复提交表单
- 使用浏览器历史记录重复提交表单
- 浏览器重复的HTTP请求
- 定时任务重复执行
- 用户双击提交按钮

## 如何保证接口幂等性？

 那么最关键的来了，如何保证接口幂等性？

 解决办法分为两个方向，一个方向是客户端防止重复调用，一个是服务端进行校验。当然，客户端防止重复提交并不是绝对可靠的，优点是实现起来比较简单。

 1.按钮只可操作一次

 一般是提交后把按钮置灰,消除用户因为重复点击而产生的重复记录,比如添加操作,由于点击两次而产生两条记录

 2.token机制

 功能上允许重复提交,但要保证重复提交不产生副作用,比如点击n次只产生一条记录,具体实现就是进入页面时申请一个token,然后后面所有的请求都带上这个token,后端根据token来避免重复请求。

![img](lu152441l02jn_tmp_fce15cf87a273432.jpg)  